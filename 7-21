ğŸ§± 1. ä»Šæ—¥æ¨è¿›ï¼ˆåšäº†ä»€ä¹ˆï¼‰ 3.30å°æ—¶  å®æˆ˜æ—¥

    å®ŒæˆBUGä¿®æ”¹ï¼ŒBUGä¸»è¦æ˜¯while Ture å¯¼è‡´ä¸»å¾ªç¯è¢«æŠ¢å ï¼Œå¯¼è‡´å¯¹è¯æ¡†ä¸€ç›´å…³é—­ä¸æ‰ï¼Œåä¿®æ”¹mianpy ï¼Œcamera_widgetç»“æ„å®ŒæˆBUGä¿®å¤   
    
  éœ€è¦ä¿®æ”¹ CameraWindow ç±»çš„ __init__ æ–¹æ³•ï¼š

  def __init__(self, master, save_dir):
      super().__init__(master)  # åªä¼ å…¥ master å‚æ•°
      self.title("æ‘„åƒå¤´(æŒ‰ç©ºæ ¼æ‹ç…§, ESCæˆ–ç‚¹Xé€€å‡º)")
      self.geometry("800x650")

      self.save_dir = save_dir  # åœ¨åˆå§‹åŒ–çˆ¶ç±»åå†è®¾ç½®è‡ªå®šä¹‰å±æ€§
      self.image_path = None

      # å…¶ä½™ä»£ç ä¿æŒä¸å˜...

  é—®é¢˜åŸå› ï¼š
  - tk.Toplevel.__init__() åªæ¥å—æ ‡å‡†çš„ Tkinter å‚æ•°
  - save_dir æ˜¯ä½ çš„è‡ªå®šä¹‰å‚æ•°ï¼Œä¸èƒ½ä¼ ç»™çˆ¶ç±»æ„é€ å‡½æ•°
  - éœ€è¦å…ˆè°ƒç”¨çˆ¶ç±»åˆå§‹åŒ–ï¼Œå†è®¾ç½®è‡ªå®šä¹‰å±æ€§

  è¿™æ ·ä¿®æ”¹ååº”è¯¥èƒ½æ­£å¸¸è¿è¡Œã€‚
> import tkinter as tk
  from tkinter import filedialog, messagebox
  import cv2
  import os
  from datetime import datetime
  from PIL import Image, ImageTk

  from ocr_utils import ocr_image
  from excel_utils import save_to_excel
  from gui_utils import show_compare_window

  class CameraWindow(tk.Toplevel):
      """
      ä¸€ä¸ªTkinteré¡¶çº§çª—å£, ç”¨äºæ˜¾ç¤ºæ‘„åƒå¤´é¢„è§ˆã€æ‹ç…§å’Œè¿”å›è·¯å¾„ã€‚
      """
      def __init_(self, master, save_dir):
          super().__init__(master)
          self.title("æ‘„åƒå¤´(æŒ‰ç©ºæ ¼æ‹ç…§, ESCæˆ–ç‚¹Xé€€å‡º)")
          self.geometry("800x650")

          self.save_dir = save_dir
          self.image_path = None

          if not os.path.exists(self.save_dir):
              os.makedirs(self.save_dir)

          self.cap = cv2.VideoCapture(0)
          if not self.cap.isOpened():
              messagebox.showerror("æ‘„åƒå¤´é”™è¯¯", "æ— æ³•æ‰“å¼€æ‘„åƒå¤´!")
              self.destroy()
              return

          self.canvas = tk.Label(self)
          self.canvas.pack(pady=10, padx=10)

          self.bind('<space>', self.capture_image_event)
          self.bind('<Escape>', self.close_window_event)
          self.protocol("WM_DELETE_WINDOW", self.close_window)

          self.update_frame()

      def update_frame(self):

          ret, frame = self.cap.read()
          if ret:

              self.current_frame_cv = frame
              img = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)
              img_pil = Image.fromarray(img)
              img_tk = ImageTk.PhotoImage(image=img_pil)

              self.canvas.imgtk = img_tk
              self.canvas.config(image=img_tk)

              self.after(15, self.update_frame)

              self.after(15, self.update_frame)
          else:
              self.close_window()

      def capture_image_event(self, event=None):
          """ç”±ç©ºæ ¼é”®è§¦å‘çš„æ‹ç…§äº‹ä»¶"""
          print("æ£€æµ‹åˆ°ç©ºé¢ï¼Œæ‹ç…§...")
          filename = datetime.now().strftime('%Y%m%d_%H%M%S') + '.jpg'
          self.image_path = os.path.join(self.save_dir, filename)

          cv2.imwrite(self.image_path, self.current_frame_cv)
          print(f"å›¾ç‰‡å·²ä¿å­˜ï¼š{self.image_path}")

          self.close_window()

      def close_window_event(self, event=None):
          """ç”±ESCé”®è§¦å‘çš„å…³é—­äº‹ä»¶"""
          self.close_window()

      def close_window(self):
          """ç»Ÿä¸€çš„çª—å£å…³é—­é€»è¾‘"""
          print("å…³é—­æ‘„åƒå¤´çª—å£...")
          if self.cap.isOpened():
              self.cap.release()
          self.destroy()

  def capture_and_recognize():
      camera_win = CameraWindow(root, save_dir='captured')
      root.wait_window(camera_win)

      img_path = camera_win.image_path
      if img_path:
          text = ocr_image(img_path)
          save_to_excel(text)
          show_compare_window(img_path, text)

  def select_and_recognize():
      img_path = filedialog.askopenfilename(filetypes=[('Image Files', '*.jpg;*.png;*.bmp')])
      if img_path:
          text = ocr_image(img_path)
          save_to_excel(text)
          show_compare_window(img_path, text)

  def capture_and_save_only():
      camera_win = CameraWindow(root, save_dir='output')
      root.wait_window(camera_win) # ç­‰å¾…æ‘„åƒå¤´çª—å£å…³é—­

      img_path = camera_win.image_path
      if img_path:
          messagebox.showinfo("æˆåŠŸ", f"å›¾ç‰‡å·²ä¿å­˜åˆ°ï¼š\n{os.path.abspath(img_path)}")

  root = tk.Tk()
  root.title("OCRè‡ªåŠ¨è¯†åˆ«å·¥å…·")
  root.geometry("300x200")

  frame = tk.Frame(root, padx=20, pady=10)
  frame.pack(expand=True, fill=tk.BOTH)

  btn_capture = tk.Button(frame, text="æ‹ç…§å¹¶è¯†åˆ«", command=capture_and_recognize)
  btn_capture.pack(pady=5, fill=tk.X)

  btn_select = tk.Button(frame, text="é€‰æ‹©å›¾ç‰‡è¯†åˆ«", command=select_and_recognize)
  btn_select.pack(pady=5, fill=tk.X)

  btn_capture_save = tk.Button(frame, text="æ‹ç…§", command=capture_and_save_only)
  btn_capture_save.pack(pady=5, fill=tk.X)


  root.mainloop()


â— 2. å¡ç‚¹ or æ¨¡ç³Šç‚¹

       éœ€è¦ä¿®æ”¹ CameraWindow ç±»çš„ __init__ æ–¹æ³•ï¼š

  def __init__(self, master, save_dir):
      super().__init__(master)  # åªä¼ å…¥ master å‚æ•°
      self.title("æ‘„åƒå¤´(æŒ‰ç©ºæ ¼æ‹ç…§, ESCæˆ–ç‚¹Xé€€å‡º)")
      self.geometry("800x650")

      self.save_dir = save_dir  # åœ¨åˆå§‹åŒ–çˆ¶ç±»åå†è®¾ç½®è‡ªå®šä¹‰å±æ€§
      self.image_path = None

      # å…¶ä½™ä»£ç ä¿æŒä¸å˜...

ğŸ” 3. æœªå®Œæˆ / æ˜æ—¥ä»»åŠ¡

       é¡¹ç›®ç»§ç»­ï¼Œæ°´ä»™èŠ±å¤ä¹ 
